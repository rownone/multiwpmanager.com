<?php	if(!file_exists(dirname(__FILE__)."/install.config.php")){        if(isset($_POST['CreateDB'])){            $dbInfo = $_POST['CreateDB'];            $adminInfo = $_POST['CreateAdmin'];                        include 'dbConn.php';                        $dbConn = new DBconn();                        $dbConn->host($dbInfo['db_host']);            $dbConn->username($dbInfo['db_username']);            $dbConn->password($dbInfo['db_password']);            $dbConn->dbname($dbInfo['db_name']);                        $dbConn->dbConnect();                        /*// Connect to MySQL            $link = mysql_connect($dbInfo['db_host'], $dbInfo['db_username'], $dbInfo['db_password']);            if (!$link) {                die('Could not connect: ' . mysql_error());            }*/                        $msg = '';            // Make my_db the current database            //$db_selected = mysql_select_db($dbInfo['db_name'], $link);            if (!$dbConn->dbSelect($dbInfo['db_name'])) {                // If we couldn't, then it either doesn't exist, or we can't see it.                $sql = 'CREATE DATABASE '.$dbInfo['db_name'];                //if (mysql_query($sql, $link)) {                if ($dbConn->dbQuery($sql)) {                    $msg .=  "Database ".$dbInfo['db_name']." created successfully\n";                    //$db_selected = mysql_select_db($dbInfo['db_name'], $link);                } else {                    $msg .= 'Error creating database: ' . mysql_error() . "\n";                }            }            // Create user table            $sql = "CREATE TABLE IF NOT EXISTS `".$dbInfo['db_prefix']."_users` (                `id` int(11) NOT NULL AUTO_INCREMENT,                `username` varchar(128) NOT NULL,                `password` varchar(128) NOT NULL,                `email` varchar(128) NOT NULL,                `type` int(11) NOT NULL,                PRIMARY KEY (`id`)              ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=50 ;";            $dbConn->dbSelect($dbInfo['db_name']);            //if (mysql_query($sql, $link)) {            if ($dbConn->dbQuery($sql)) {                $msg .=  "Table ".$dbInfo['db_prefix']."user created successfully\n";            } else {                $msg .= 'Error creating table user: ' . mysql_error() . "\n";            }            // Create options table            $sql = "CREATE TABLE IF NOT EXISTS `".$dbInfo['db_prefix']."_options` (                `id` int(11) NOT NULL AUTO_INCREMENT,                `name` varchar(64) NOT NULL,                `value` longtext NOT NULL,                PRIMARY KEY (`id`)              ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;";            //if (mysql_query($sql, $link)) {            if ($dbConn->dbQuery($sql)) {                $msg .=  "Table ".$dbInfo['db_prefix']."options created successfully\n";            } else {                $msg .= 'Error creating table user: ' . mysql_error() . "\n";            }            //create user            $sql = "INSERT INTO `".$dbInfo['db_prefix']."_users` (`username`, `password`, `email`, `type`) VALUES                    ('".$adminInfo['username']."', '".$adminInfo['password']."', '".$adminInfo['email']."', 1)";            //if (mysql_query($sql, $link)) {            if ($dbConn->dbQuery($sql)) {                $msg .=  $adminInfo['username']." user created successfully\n";            } else {                $msg .= 'Error creating '.$adminInfo['username'].': ' . mysql_error() . "\n";            }                        //insert site_title            $sql = "INSERT INTO `".$dbInfo['db_prefix']."_options` (`name`, `value`) VALUES                    ('site_title', '".$adminInfo['sitetitle']."')";                        if ($dbConn->dbQuery($sql)) {                $msg .=  " site_title inserted successfully\n";            } else {                $msg .= 'Error db_prefix '.$adminInfo['db_prefix'].': ' . mysql_error() . "\n";            }                        //insert tbl_prefix            $sql = "INSERT INTO `".$dbInfo['db_prefix']."_options` (`name`, `value`) VALUES                    ('tbl_prefix', '".$adminInfo['db_prefix']."')";                        if ($dbConn->dbQuery($sql)) {                $msg .=  " table_prefix inserted successfully\n";            } else {                $msg .= 'Error creating table_prefix '.$adminInfo['db_prefix'].': ' . mysql_error() . "\n";            }            //mysql_close($link);            $dbConn->dbClose();                        /*$url = $_SERVER['REQUEST_URI']; //returns the current URL            $parts = explode('/',$url);            $dir = '';            for ($i = 0; $i < count($parts) - 1; $i++) {                $dir .= $parts[$i] . "/";            }            //$url = $_SERVER['DOCUMENT_ROOT'].$dir."protected/config/main.php";            $url = $_SERVER['DOCUMENT_ROOT'].$dir;*/            $url = $dbConn->getDocumentFolder();            $content = "";            //create config            //$file = fopen($_SERVER['DOCUMENT_ROOT'].$_SERVER['REQUEST_URI']."protected/config/main.php", "wb") or exit("Unable to open file!");            $file = fopen($url."protecteld/config/main.php", "r") or exit("Unable to open file!");            while(!feof($file)){                $content .= fgets($file);            }            $content = preg_replace("/{{localhost}}/",$dbInfo['db_host'],$content);            $content = preg_replace("/{{dbname}}/",$dbInfo['db_name'],$content);            $content = preg_replace("/{{username}}/",$dbInfo['db_username'],$content);            $content = preg_replace("/{{password}}/",$dbInfo['db_password'],$content);            $content = preg_replace("/{{sitetitle}}/",$adminInfo['sitetitle'],$content);            //fwrite($file,$content);            fclose($file);            $file=fopen($url."protected/config/main.php", "wb");            fwrite($file,$content);            fclose($file);            //            /*            $content = "";            //create user model            //$file = fopen($_SERVER['DOCUMENT_ROOT'].$_SERVER['REQUEST_URI']."protected/tpl/User.php", "r") or exit("Unable to open file!");            $file = fopen($url."protected/tpl/Users.php", "r") or exit("Unable to open file!");            while(!feof($file)){              $content .= preg_replace("/{{tbl_users}}/",$dbInfo['db_prefix']."_users",fgets($file));            }            fclose($file);            $file=fopen($url."protected/models/Users.php","wb");            fwrite($file,$content);            fclose($file);            */                        //create config file            $content = 'installation successful! dont delete this file.';            $file=fopen($url."install/config.php","wb");            fwrite($file,$content);            fclose($file);            //create .htaccess file//            $content = 'AddDefaultCharset UTF-8////                Options +FollowSymLinks//                IndexIgnore */*//                RewriteEngine on////                # if a directory or a file exists, use it directly//                RewriteCond %{REQUEST_FILENAME} !-f//                RewriteCond %{REQUEST_FILENAME} !-d////                # otherwise forward it to index.php//                RewriteRule . index.php//                ';////            $file=fopen($url.".htaccess","wb");//            fwrite($file,$content);//            fclose($file);            $pageURL = 'http';            if ($_SERVER["HTTPS"] == "on") {$pageURL .= "s";}            $pageURL .= "://";            if ($_SERVER["SERVER_PORT"] != "80") {                $pageURL .= $_SERVER["SERVER_NAME"].":".$_SERVER["SERVER_PORT"].$_SERVER["REQUEST_URI"];            } else {                $pageURL .= $_SERVER["SERVER_NAME"].$_SERVER["REQUEST_URI"];            }                       header("Location: ".$pageURL);        }		require dirname(__FILE__)."/index.php";		exit();	}	?>